name: $(BuildDefinitionName).$(DayOfYear)$(Rev:.r)

trigger:
  - none

pr:
  - none

pool:
  vmImage: "ubuntu-latest"

variables:
  #=============================================================#
  # The following Variables should be set on the pipeline level #
  #=============================================================#

  # Name of the Environment
  - name: environmentName
    value: "dev"

  # Name of the deployment Location
  - name: locationName
    value: "westus"

  # ARM Service Connection Name used for environment Key Vault access
  - name: keyVaultArmSvcConnectionName
    value: "Symphony-KV"

  # Environment Key Vault Name
  - name: keyVaultName
    value: "kv-symphony-env"

jobs:
  - template: ./template.bicep.validate.yml
    parameters:
      environmentName: $(environmentName)
      locationName: $(locationName)
      keyVaultArmSvcConnectionName: $(keyVaultArmSvcConnectionName)
      keyVaultName: $(keyVaultName)

  - template: ./template.bicep.previewdeploy.yml
    parameters:
      environmentName: $(environmentName)
      locationName: $(locationName)
      keyVaultArmSvcConnectionName: $(keyVaultArmSvcConnectionName)
      keyVaultName: $(keyVaultName)

  - template: ./template.bicep.test.yml
    parameters:
      environmentName: $(environmentName)
      locationName: $(locationName)
      keyVaultArmSvcConnectionName: $(keyVaultArmSvcConnectionName)
      keyVaultName: $(keyVaultName)
